# ============================================================
# spec_text.py
# Drum Score Player v0.7.2
# テキスト譜面フォーマット仕様（改訂版・ヘルプ用）
# ============================================================


def get_spec_text() -> str:
    return r"""
============================================================
 Drum Score Player v0.7.2
 テキスト譜面フォーマット仕様（完全版）
============================================================

本仕様は Drum Score Player のテキスト譜面を確実に解析するための
公式ルールです。教材制作・複数小節対応・エラーの明確化を目的として
最適化されています。ヘルプ表示の呼び出し口は必ず
`get_spec_text()`（関数名固定）を利用することを前提とします。

まずは以下の「クイックチェックリスト」を踏まえ、細則で補完する構成に
なっています。優先順位は上から順に高く、上位が守れていれば下位の
ルールは読みやすさのためのガイドとなります。

------------------------------------------------------------
 クイックチェックリスト（作成時の最終確認用）
------------------------------------------------------------
1. TIME × PULSES_PER_BEAT で決まる 1小節ステップ数を守り、
   各トラックの合計を必ずその整数倍にする。
2. TEMPO / TIME / PULSES_PER_BEAT の 3 つがヘッダーに必ずある。
3. CHECK ブロックを末尾に置き、トラック名と数値を譜面と一致させる。
4. トークンに余計な文字（全角スペース・カンマ等）が混入していない。
5. トラックは 1 ファイルあたり 12 本以内を推奨（描画/操作の実用上）。

------------------------------------------------------------
 1. ヘッダー（必須・順不同）
------------------------------------------------------------
以下の3つは必須:

    TEMPO=78
    TIME=4/4
    PULSES_PER_BEAT=4

以下は任意（なくても動作する）:

    FILENAME=Example.txt
    TITLE=Cool Groove

TIME と PULSES_PER_BEAT が譜面の最重要基準となる。

------------------------------------------------------------
 2. 小節ステップ判定（最優先チェック）
------------------------------------------------------------
1 小節のステップ数は:

    TIME の分子 × PULSES_PER_BEAT

例:
    TIME=4/4, PPB=4 → 1小節 = 16 ステップ

各トラックの合計ステップ数は必ず:

    16, 32, 48, 64, ... のように 1小節の整数倍

数倍でない場合:

    [ERROR] トラック HH: 合計 34 ステップは 1小節16 の整数倍ではありません。
     → 2小節分 + 余り2

------------------------------------------------------------
 3. トラック定義（HH / SD / BD など）
------------------------------------------------------------
形式:

    HH: x1 x1 x1 x1 x1 ...

行が長い場合は、2行目以降にトラック名を省略できる:

    HH: x1 x1 x1 x1
        x1 x1 x1 x1

トラック名は自由。大文字/小文字どちらも許可。トラック数は
解析上は制限しないが、GUI 操作のしやすさから 12 本以内を推奨。

------------------------------------------------------------
 4. 小節区切り "|"（任意）
------------------------------------------------------------
視覚的な区切りとして "|" を自由に挿入できる。
解析時には完全に無視される。

    HH: x1 x1 x1 x1 | x1 x1 x1 x1 |

------------------------------------------------------------
 5. コメント（任意）
------------------------------------------------------------
"#" 以降は行末までコメント扱い。

    # bar 1
    HH: x1 x1 x1 x1   # コメント

コメントは解析内容に影響しない。

------------------------------------------------------------
 6. 音符トークン（最重要）
------------------------------------------------------------
「記号 + 数値」で構成される。

● 音符
    xN, oN, XN, ON  → N ステップ鳴らす

● 休符
    -N, rN, RN, _N → N ステップ休む

N は整数。「-16」「-14」など実ステップ数をそのまま解釈する。

※ 一般楽譜の休符構造とは無関係
※ アプリは “N ステップ” という数値だけを扱う

------------------------------------------------------------
 7. 強弱記号（任意）
------------------------------------------------------------
記号の末尾に強弱を追加:

    x1^f
    o1^pp

認識される強弱:
    pp, p, mp, mf, f, ff

未知の強弱はエラー。

------------------------------------------------------------
 8. 禁止事項（解析不能）
------------------------------------------------------------
× トークン中に余計な文字:
    x1 aaa x1

× 数字を含まないトークン:
    x

× カンマ区切り:
    x1,x1,x1

× 全角スペース:
    x1　x1

× 未知の記号:
    y1

× “\” バックスラッシュ（禁止）

------------------------------------------------------------
 9. 正しい例（複数小節）
------------------------------------------------------------
TEMPO=90
TIME=4/4
PULSES_PER_BEAT=4

HH: x1 x1 x1 x1 x1 x1 x1 x1 | x1 x1 x1 x1 x1 x1 x1 x1
SD: -4 x1 -3 -4 x1 -3
BD: o1 -3 -4 o1 -3 -4

すべて 16 または 32 ステップなど整数倍であれば OK。

------------------------------------------------------------
 10. 付点音符の扱い（重要）
------------------------------------------------------------
アプリは付点記号を理解しない。

付点はステップ数に変換して書く:

例: 付点8分 → 1.5 × 4 = 6 ステップ
    x6 と書く

すべて整数ステップに還元して書くこと。

------------------------------------------------------------
 11. 休符の美しいまとめ方（将来のオプション）
------------------------------------------------------------
現在の仕様では:

    -1, -2, -3, -4, -8, -16 ... を「そのままの数値」で解釈。

一般的楽譜のような「拍に基づく最適化」は行わない。

将来的に「表示用の整形」（リフォーマッタ）を実装する可能性はあるが、
本仕様には含めない。

------------------------------------------------------------
12. 合計ステップチェック（必須 / ファイル末尾）
------------------------------------------------------------

譜面ファイルの末尾には、すべてのトラックの合計ステップ数を検算して
記述する CHECK ブロックを必ず配置する。

形式：

%%CHECK:
  Track01_Total = 64
  Track02_Total = 64
  Track03_Total = 64
  Bars_Total    = 4
  Steps_Per_Bar = 16
%%ENDCHECK

ルール：

- CHECK ブロックは必須。省略するとパーサーが読み込みエラーを返す。
- Track*_Total はトラック名＋ "_Total" で記述し、実際の合計ステップ数と一致させる。
- Bars_Total / Steps_Per_Bar も自動検算し、不一致があればエラーになる。
- CHECK ブロックに余分なトラック名がある場合もエラーとして扱う。

------------------------------------------------------------
============================================================
 Drum Score Player v0.7.2
 テキスト譜面仕様（ヘルプ用サマリー）
============================================================

本仕様の重要事項を 3 行で再掲:

1. TIME × PULSES_PER_BEAT が 1小節のステップ数。
2. 各トラックのステップ合計は必ず 1小節の整数倍。
3. CHECK ブロックを最後に置き、トラック名と数値を合わせる。
"""
