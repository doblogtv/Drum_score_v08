# ============================================================
# spec_text.py
# Drum Score Player v0.8.0
# テキスト譜面フォーマット仕様（改訂版・ヘルプ用）
# ============================================================


def get_spec_text() -> str:
    return r"""
============================================================
 Drum Score Player v0.8.0
 テキスト譜面フォーマット仕様（完全版）
============================================================

本仕様は Drum Score Player のテキスト譜面を確実に解析するための
公式ルールです。教材制作・複数小節対応・エラーの明確化を目的として
最適化されています。ヘルプ表示の呼び出し口は必ず
`get_spec_text()`（関数名固定）を利用することを前提とします。

まずは以下の「クイックチェックリスト」を踏まえ、細則で補完する構成に
なっています。優先順位は上から順に高く、上位が守れていれば下位の
ルールは読みやすさのためのガイドとなります。

------------------------------------------------------------
 クイックチェックリスト（作成時の最終確認用）
------------------------------------------------------------
1. TIME と PULSES_PER_BEAT の組み合わせで 1 小節ステップ数を決め、
   各トラックの 1 行を必ずその長さ（不足は「.」）にそろえる。
2. ヘッダーには TIME と PULSES_PER_BEAT を必ず書く（TEMPO は任意）。
3. CHECK ブロックはトラック名_Total のみを列挙し、譜面と一致させる。
4. トークンは小節長と一致するよう音価で埋める。数字（1/2/4/8/16/32/64）や
   `+` 付きの伸長記法を使用する場合も、合計ステップが必ず一致することを確認。
5. トラックは 1 ファイルあたり 12 本以内を推奨（描画/操作の実用上）。

------------------------------------------------------------
 1. ヘッダー（必須・順不同）
------------------------------------------------------------
必須:

    TIME=4/4
    PULSES_PER_BEAT=4

任意（なくても動作する）:

    TEMPO=96           ← 省略時は 120 とみなす
    FILENAME=Example.txt
    TITLE=Cool Groove

TIME と PULSES_PER_BEAT が譜面の最重要基準となる。

------------------------------------------------------------
 2. 小節ステップ数と固定長スロット
------------------------------------------------------------
1 小節のステップ数は:

    TIME の分子 × PULSES_PER_BEAT

例:
    TIME=4/4, PPB=4 → 1小節 = 16 ステップ

各トラック行は「1 小節 = 16 ステップ」など小節長と合計が一致するように書く。
数字で音価を指定した場合も、展開後の総ステップが小節長と一致することを確認する。
足りない部分は "."（1 ステップのパディング休符）や ".+++" などで埋める。

------------------------------------------------------------
 3. トラック定義（毎行 1 小節固定）
------------------------------------------------------------
形式:

    HH: x x x x x x x x x x x x x x x x
    HH: x^f x x x x^f x x x x^f x x x x^f x x x   ← 2 小節目
    SD: . . . . . x . . . x . . . x . .

- 1 行 = 1 小節。トラック名は毎行必須（省略・継続行は禁止）。
- "|" の挿入は禁止。
- 行を展開した合計ステップが 1 小節長と一致しない場合、パーサーは拒否する。

------------------------------------------------------------
 4. 音符トークン（最重要）
------------------------------------------------------------
「音価指定」と「1 ステップ記号 + 伸長」の 2 系統を併用できる。

● 音価指定トークン（推奨）
    1, 2, 4, 8, 16, 32, 64
    - 先頭に x/o/X/O を付けて音色を明示可能（例: o2+++++++）。
    - 先頭に -, r, R, _ を付ければ休符扱い（例: -4---- は 4 分休符）。
    - 必要に応じて末尾に「長さ-1 個」の `+` を並べ、視覚的な長さ確認に使う。

● 1 ステップ記号（従来通り）
    音符: x, o, X, O
    休符/パディング: -, r, R, _, .
    - 末尾に `+` を重ねれば任意ステップに伸ばせる（例: x+++ は 4 ステップ）。

- バックスラッシュやカンマ、全角スペースなど未知の文字はすべて禁止。

------------------------------------------------------------
 5. 強弱記号（任意）
------------------------------------------------------------
記号の末尾に強弱を追加（"." には付与不可）:

    x^f
    o^pp

認識される強弱:
    pp, p, mp, mf, f, ff

未知の強弱はエラー。

------------------------------------------------------------
 6. コメント（任意）
------------------------------------------------------------
"#" 以降は行末までコメント扱い。解析内容に影響しない。

------------------------------------------------------------
 7. 正しい例（複数小節・固定長）
------------------------------------------------------------
TIME=4/4
PULSES_PER_BEAT=4

HH: x x x x x x x x x x x x x x x x
HH: x^f x x x x^f x x x x^f x x x x^f x x x
SD: . . . . . x . . . x . . . x . .
SD: . . . . x . . . x . . . x . . .
BD: x . . . . . x . . . x . . . x .
BD: x . . . x . . . x . . . x . . .

展開後の合計が 16 ステップ（TIME=4/4, PPB=4 の場合）にそろっていれば OK。

------------------------------------------------------------
 8. CHECK ブロック（必須 / ファイル末尾）
------------------------------------------------------------

譜面ファイルの末尾には、すべてのトラックの合計ステップ数を検算して
記述する CHECK ブロックを必ず配置する。

形式：

%%CHECK:
  Track01_Total = 64
  Track02_Total = 64
  Track03_Total = 64
%%ENDCHECK

ルール：

- CHECK ブロックは必須。省略するとパーサーがエラーを返す。
- Track*_Total はトラック名＋ "_Total" で記述し、実際の合計ステップ数と一致させる。
- Bars_Total / Steps_Per_Bar など派生値は書かない。余分なキーがあればエラー。

------------------------------------------------------------
============================================================
 Drum Score Player v0.8.0
 テキスト譜面仕様（ヘルプ用サマリー）
============================================================

本仕様の重要事項を 3 行で再掲:

1. TIME と PULSES_PER_BEAT だけを基準に 1 小節長を決め、各行の合計ステップをそろえる。
2. トークンは音価指定（1/2/4/8/16/32/64）か 1 ステップ記号＋`+` 伸長。"|"・継続行は禁止。
3. CHECK ブロックは各トラックの *_Total だけを記述し、値を必ず一致させる。
"""
